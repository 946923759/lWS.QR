<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!--
    // To set from code execute the following:
    //
    //document.getElementById('size').value = '" + size +"';"
    //document.getElementById('dark').value = '" + dark + "';"
    //document.getElementById('light').value = '" + light + "';"
    //document.getElementById('corr').value = '" + corr +"';"
    //document.getElementById('qrtext').value = '" + escapeCharsForJSON(txt) + "';"
    //document.getElementById('text').innerHTML = '" + escapeCharsForJSON(txt) + "';"
    //document.getElementById('unattended').style.display = 'block';";
    //
    // For interactive mode:
    //
    //document.getElementById('interactive').style.display = 'block';
    //
    // Then call for both variants:
    //
    //refresh();
-->
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">

    <link rel="stylesheet" type="text/css" href="common.css">

    <script type="text/javascript" src="qrcode.min.js"></script>

    <script type="text/javascript">
    // TODO: remove debug
    console.log('start head script');
    var welcome = 'Loading...';

    var qrenc;
    function QR (size, dark, light, cor) {
      var cl = QRCode.CorrectLevel.L;
      switch(cor) {
          case 'L':
                cl=QRCode.CorrectLevel.L
                break;
          case 'M':
                cl=QRCode.CorrectLevel.M
                break;
          case 'Q':
                cl=QRCode.CorrectLevel.Q
                break;
          case 'H':
                cl=QRCode.CorrectLevel.H
                break;
          default:
                cl=QRCode.CorrectLevel.L

      }  
      qrenc = new QRCode(document.getElementById('qrcode'), {
          text: '',
          width: size,
          height : size,
          colorDark : dark,
          colorLight : light,
          correctLevel : cl
      });
    }
    function refresh() {
          // TODO: remove debug
          console.log('start refresh()');
          var qrtext = document.getElementById('qrtext').value;
          var qrarea = document.getElementById('qrcode');
          if (qrtext.length == 0) {
            qrarea.style.width = '90%';
            qrarea.style.margin = 'auto';
            qrarea.innerHTML = welcome;
          } else {
            var mSize = document.getElementById('size').value;
            var mDark = document.getElementById('dark').value;
            var mLight = document.getElementById('light').value;
            var mCorr = document.getElementById('corr').value;
            if (mSize > 1024 || mSize < 64) mSize = 128;
            if (!checkRGB(mDark)) mDark = '#000000';
            if (!checkRGB(mLight)) mLight = '#E0FFFF';

            qrarea.style.width = "20%";
            qrarea.style.margin = "1.2em auto";
            qrarea.innerHTML='';
            QR(
              mSize,
              mDark,
              mLight,
              document.getElementById('corr').value
            );
            qrenc.clear();
            qrenc.makeCode(qrtext);
          }
          // TODO: remove debug
          console.log('finish refresh()');
    }
    function setDefault() {
          // TODO: remove debug
          console.log('start setDefault()');
          document.getElementById('qrcode').innerHTML='';
          QR('128', '#000000', '#e0ffff', 'H');
          qrenc.clear();
          qrenc.makeCode(document.getElementById('qrtext').value);
           // TODO: remove debug
          console.log('finish setDefault()');
    }
    function checkRGB(color) {
        return color.match(/^\#[0-9A-Fa-f]{3}$|^\#[0-9A-Fa-f]{6}$/);
    }
     // TODO: remove debug
    console.log('finish head script');
    </script>

</head>
<body>

    <!-- Main tab -->
    <div id="Main" class="tab" style="display:block">
<div class="frame">
<div
    id="qrcode"
    style="
        display:table;
        width:85%;
        margin: 1.0em auto 1em;
    "
>
</div>
</div>

<div
  class="frame"
  id="unattended"
  style="
    padding:1em;
    display:none;
  "
>
  <span
    id="text"
    style="
      color:#0f0f0f;
      font-family:monospace;
      font-weight:bold;
      word-wrap: break-word;
      font-size:1.3em;
    "
  />
</div>

<div class="frame" id="interactive" style="display:none">
<form>
  <br />
  <textarea
      style="
          width:98%;
          margin: -1.3em 0 0.5em 0;
          border-radius: 7px;
      "
      placeholder="Enter text to encode here..."
      rows="2"
      id="qrtext"
      onkeyup="
        refresh();
      "
  ></textarea>
  <br/>
  <button
      style="width:49.25%"
      type="button"
      onClick="refresh();"
       console.log('encode button');     
  >
Encode
  </button>
  <button
      style="width:49.25%"
      type="button"
      onClick="
          qrenc.clear();
          qrenc.makeCode('');
          document.getElementById('qrtext').value = '';
          refresh();
      "
  >
Clear
  </button>
    <div class="frame">
    <table align="center">
      <tr>
        <td>
  Size [64px - 1024px]
        </td>
        <td align="right">
  <input type="number"  id="size" size="4" value="256" onkeyup="refresh();" style="width:3em;" />
        </td>
     </tr>
     <tr>
       <td colspan="2">
         <hr style="margin-top:0.1em;margin-bottom:0.1em"/>
       </td>
     </tr>
     <tr>
       <td colspan="2">
  Color [#RGB or #RRGGBB]
       </td>
     </tr>
     <tr>
       <td align="center">
         foreground
       </td>
       <td align="center">
         background
       </td>
     </tr>
     <tr>
       <td align="center">
  <input type="text" id="dark" size="7" value="#000000" onkeyup="refresh();" />
       </td>
       <td align="center">
  <input type="text" id="light" size="7" value="#e0ffff" onkeyup="refresh();"/>
       </td>
     </tr>
     <tr>
       <td colspan="2">
         <hr style="margin-top:0.1em;margin-bottom:0.1em"/>
       </td>
     </tr>
     <tr>
       <td>
  Error correction level
       </td>
       <td align="right">
  <select name="correction" id="corr" value="L" onchange="refresh();">
      <option value="L">L (7%)</option>
      <option value="M">M (15%)</option>
      <option value="Q">Q (25%)</option>
      <option value="H">H (30%)</option>
  </select>
     </td>
   </tr>
 </table>
 </div>
</form>
</div>

  <script type="text/javascript">
    // Initialization
    QR('128', '#000000', '#e0ffff', 'H');
    qrenc.clear();
    refresh();
  </script>

        </div>

</body>

</html>
